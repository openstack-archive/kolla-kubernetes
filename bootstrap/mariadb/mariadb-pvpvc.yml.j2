{%- set resourceName = "mariadb" -%}
{%- set size = '10Gi' %}

{%- if storage_provider not in ["host"] %}

{%- if storage_provider not in ["aws"] -%}

apiVersion: v1
kind: PersistentVolume
metadata:
  name: {{ resourceName }}
spec:
  capacity:
    storage: {{ size }}
  accessModes:
    - ReadWriteOnce
{%- if storage_provider == "gce" %}
  gcePersistentDisk:
    pdName: {{ resourceName }}
    fsType: ext4
{%- elif storage_provider == "ceph" %}
  rbd:
    monitors:
      {%- for k in storage_ceph.monitors %}
      - "{{ k }}:6789"
      {%- endfor %}
    pool: {{ storage_ceph.pool }}
    image: {{ resourceName }}
    user: {{ storage_ceph.user }}
    keyring: {{ storage_ceph.keyring }}
    secretRef:
      name: {{ storage_ceph.secretName }}
    fsType: ext4
    readOnly: false
{%- else %}
raise 'Unknown provider: check "./etc/kolla-kubernetes/kolla-kubernets.yml:storage_provider"'
{%- endif %}

---
{% endif -%}

apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: {{ resourceName }}
{%- if storage_provider == "aws" %}
  annotations:
    volume.alpha.kubernetes.io/storage-class: experimental_can_be_anything_in_kubernetes_1_2
{%- endif %}
spec:
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: {{ size }}

{%- endif %}
