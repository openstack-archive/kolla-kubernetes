apiVersion: v1
data:
  config.json: |
    {
        "command": "neutron-openvswitch-agent --config-file /etc/neutron/neutron.conf --config-file /etc/neutron/plugins/ml2/ml2_conf.ini",
        "config_files": [
            {
                "source": "/var/lib/kolla/config_files/neutron.conf",
                "dest": "/etc/neutron/neutron.conf",
                "owner": "neutron",
                "perm": "0600"
            },
            {
                "source": "/var/lib/kolla/config_files/ml2_conf.ini",
                "dest": "/etc/neutron/plugins/ml2/ml2_conf.ini",
                "owner": "neutron",
                "perm": "0600"
            },
            {
                "source": "/var/lib/kolla/config_files/policy.json",
                "dest": "/etc/neutron/policy.json",
                "owner": "neutron",
                "perm": "0600",
                "optional": true
            }
        ],
        "permissions": [
            {
                "path": "/var/log/kolla/neutron",
                "owner": "neutron:neutron",
                "recurse": true
            }
        ]
    }
  ml2-conf.ini: |+
    [ml2]
    type_drivers = flat,vlan,vxlan
    tenant_network_types = vxlan
    mechanism_drivers = openvswitch,l2population

    [ml2_type_vlan]
    network_vlan_ranges =

    [ml2_type_flat]
    flat_networks = physnet1

    [ml2_type_vxlan]
    vni_ranges = 1:1000
    vxlan_group = 239.1.1.1

    [securitygroup]
    firewall_driver = neutron.agent.linux.iptables_firewall.OVSHybridIptablesFirewallDriver

    [agent]
    tunnel_types = vxlan
    l2_population = true
    arp_responder = true

    [ovs]
    bridge_mappings = physnet1:br-ex
    ovsdb_connection = tcp:0.0.0.0:6640
    local_ip = 0.0.0.0

  neutron.conf: |+
    [DEFAULT]
    debug = True
    log_dir = /var/log/kolla/neutron
    use_stderr = False
    bind_host = 0.0.0.0
    bind_port = 9696
    api_paste_config = /usr/share/neutron/api-paste.ini
    endpoint_type = internalURL
    api_workers = 1
    metadata_workers = 1
    metadata_proxy_socket = /var/lib/neutron/kolla/metadata_proxy
    interface_driver = openvswitch
    allow_overlapping_ips = true
    core_plugin = ml2
    service_plugins = router
    transport_url = rabbit://openstack:qx9Dzn6Ak6yo6KzFFvcS4OFWzZ9Qr2ClLz70mopf@rabbitmq:5672

    [nova]
    auth_url = http://keystone-admin:35357/v3
    auth_type = password
    project_domain_id = default
    user_domain_id = default
    region_name = RegionOne
    project_name = service
    username = nova
    password = KxYAMikygyQfwNbmzY3DCVshdIxECSRLFRi3fKvT
    endpoint_type = internal

    [oslo_concurrency]
    lock_path = /var/lib/neutron/tmp

    [agent]
    root_helper = sudo neutron-rootwrap /etc/neutron/rootwrap.conf

    [database]
    connection = mysql+pymysql://neutron:luG1w24HIV5BmxABFyowmi0cXLrB18BMWDtZJzgh@mariadb/neutron
    max_retries = -1

    [keystone_authtoken]
    auth_uri = http://keystone-internal:5000/v3
    auth_url = http://keystone-admin:35357/v3
    auth_type = password
    project_domain_id = default
    user_domain_id = default
    project_name = service
    username = neutron
    password = u57gEXEeXAvfUdmL15BAHJYsTiHDtc3E1bpF6tqW
    memcache_security_strategy = ENCRYPT
    memcache_secret_key = 2W6qqH7QKzqQPgEeEjXbM6hOv2wRstw4bucPz6Js
    memcache_servers = memcached

    [oslo_messaging_notifications]
    driver = noop

kind: ConfigMap
metadata:
  name: neutron-openvswitch-agent
