{{- $orchestrationImage := .Values.orchestration_image_full }}
apiVersion: batch/v1
kind: Job
spec:
  template:
    spec:
      containers:
        - image: "{{ $orchestrationImage }}"
          name: generate-configmaps
          command: ["ansible-playbook"]
          args: ["-e", "@/etc/kolla-globals/globals.yml", "-e", "node_custom_config=/etc/kolla-overrides" , "-e", "@/etc/kolla-passwords/passwords.yml","-e", "k8s_generate_configmaps=yes", "-e", "CONFIG_DIR=/etc/kolla", "ansible/site.yml"]
          volumeMounts:
          - name: globals
            mountPath: /etc/kolla-globals/
          - name: passwords
            mountPath: /etc/kolla-passwords/
          - name: overrides
            mountPath: /etc/kolla-overrides/
      volumes:
        - name: globals
          configMap:
            name: globals
        - name: passwords
          secret:
            secretName: passwords
        - name: overrides
          configMap:
            name: conf-overrides
      restartPolicy: OnFailure
metadata:
  name: mariadb-config
