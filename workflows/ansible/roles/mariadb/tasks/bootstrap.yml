---
- name: Bootstrapping MariaDB
  command: kollakube resource create bootstrap mariadb-bootstrap

- name: Waiting for the MariaDB bootstrap to complete
  command: kubectl get jobs mariadb-bootstrap -o json --namespace {{ kolla_kubernetes_namespace }}
  register: result
  until:
    - "{{ (result.stdout | from_json).status.succeeded is defined }}"
    - "{{ (result.stdout | from_json).status.succeeded }} == 1"
  retries: 12
  delay: 5
  ignore_errors: True

- fail: msg="Mariadb failed to bootstrap. Check the logs of the mariadb-bootstrap container."
  when: "{{ (result.stdout | from_json).status.succeeded is undefined }}"

- name: Cleanup MariaDB Bootstrap pod
  command: kollakube resource delete bootstrap mariadb-bootstrap
